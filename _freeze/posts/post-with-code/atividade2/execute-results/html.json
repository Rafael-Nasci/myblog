{
  "hash": "f95a8d2de8ba9c8feff5ccdadc8f59b8",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: 1. Configura√ß√£o e Busca de Dados\n---\n\n\n\n## 1. Configura√ß√£o e Busca de Dados\n\n#| label: busca-dados\n#| output: true # TEMPORARIAMENTE: MUDAMOS PARA TRUE PARA DEBUG\n#| echo: true \n\nimport requests\nimport folium\nfrom IPython.display import display \n\n# ... (restante das importa√ß√µes) ...\n\n# ------------------------------------------------------------------\n# CONFIGURA√á√ÉO\n# ------------------------------------------------------------------\nTOKEN = \"4e72fe0c1c920056a01ded0b98549432a303ea32adc917693a53e0b331b581bc\" \nBASE_URL = \"[http://api.olhovivo.sptrans.com.br/v2.1](http://api.olhovivo.sptrans.com.br/v2.1)\"\nLINHA_BUSCADA = \"809U-10\" \n\n# ------------------------------------------------------------------\n# AUTENTICA√á√ÉO\n# ------------------------------------------------------------------\ns = requests.Session()\nauth_url = f\"{BASE_URL}/Login/Autenticar?token={TOKEN}\"\nauth = s.post(auth_url)\n\nif auth.text.lower() == \"true\":\n    autenticacao_ok = True\n    print(\"‚úÖ STATUS: Autentica√ß√£o bem-sucedida!\")\nelse:\n    autenticacao_ok = False\n    print(\"‚ùå STATUS: Falha na autentica√ß√£o!\")\n\n# ------------------------------------------------------------------\n# BUSCA DE C√ìDIGO DA LINHA E DADOS\n# ------------------------------------------------------------------\n\n# ... (c√≥digo de busca de linha e paradas permanece igual) ...\n\n# ------------------------------------------------------------------\n# EXIBI√á√ÉO DE DADOS COLETADOS (DEBUG)\n# ------------------------------------------------------------------\nif codigo_linha != -1:\n    print(f\"Linha {LINHA_BUSCADA} encontrada. C√≥digo Interno: {codigo_linha}\")\n    print(f\"Paradas coletadas: {len(dados_paradas)}\")\n    print(f\"√înibus em tempo real: {len(onibus)}\")\nelse:\n    print(f\"Linha {LINHA_BUSCADA} n√£o encontrada.\")------------------------------------------------------------------\n# BUSCA DE PARADAS E POSI√á√ïES\n# ------------------------------------------------------------------\nif codigo_linha != -1:\n    # Buscar paradas\n    paradas_resp = s.get(f\"{BASE_URL}/Parada/BuscarParadasPorLinha?codigoLinha={codigo_linha}\")\n    dados_paradas = paradas_resp.json() if isinstance(paradas_resp.json(), list) else []\n\n    # Buscar posi√ß√µes de √¥nibus\n    posicoes_resp = s.get(f\"{BASE_URL}/Posicao?codigoLinha={codigo_linha}\")\n    dados_posicoes = posicoes_resp.json()\n    onibus = dados_posicoes.get(\"vs\", [])\nelse:\n    dados_paradas = []\n    onibus = []\n    ### 2. Gera√ß√£o e Exibi√ß√£o do Mapa\n\n### 2. Mapa Interativo (Link em Nova Aba) üåç\n\n### 2. Mapa Interativo (Link em Nova Aba) üåç\n\n### 2. Mapa Interativo (Link em Nova Aba) üåç\n\n### 2. Gera√ß√£o e Salva√ß√£o do Mapa\n\n\n\nfrom folium import Map, Marker, Icon\n\narquivo_mapa = \"mapa_frota_interativa.html\"\n\nif not autenticacao_ok or len(dados_paradas) == 0:\n    print(f\"‚ö†Ô∏è **STATUS:** Mapa n√£o gerado. Falha na autentica√ß√£o ou Linha '{LINHA_BUSCADA}' n√£o tem dados.\")\n    # For√ßa a cria√ß√£o de um arquivo de mapa vazio se a linha falhar\n    mapa_criado = False \nelse:\n    # Cria√ß√£o do Mapa (o mesmo c√≥digo que j√° testamos)\n    lat0 = dados_paradas[0][\"Latitude\"]\n    lon0 = dados_paradas[0][\"Longitude\"]\n    mapa = Map(location=[lat0, lon0], zoom_start=14)\n    # ... (Adi√ß√£o de Marcadores) ...\n    for p in dados_paradas:\n        Marker(location=[p[\"Latitude\"], p[\"Longitude\"]], popup=p[\"Nome\"], icon=Icon(color=\"blue\", icon=\"info-sign\")).add_to(mapa)\n    for b in onibus:\n        Marker(location=[b[\"py\"], b[\"px\"]], popup=f\"√înibus ID: {b['p']}\", icon=Icon(color=\"red\", icon=\"bus\")).add_to(mapa)\n\n    mapa.save(arquivo_mapa) # Salva o mapa no disco\n    \n    print(f\"‚úÖ **STATUS:** Mapa salvo com sucesso.\")\n    print(f\"Nome do arquivo: **{arquivo_mapa}**\") # Imprime o nome do arquivo para usarmos no Markdown\n    ---\n### Acesso ao Mapa\n\nClique no link abaixo para abrir o mapa interativo em uma nova aba.\n\n<div style=\"text-align: center;\">\n    <a href=\"mapa_frota_interativa.html\" target=\"_blank\" style=\"padding: 10px 20px; text-decoration: none; border-radius: 5px; color: white; background-color: #007bff; font-weight: bold; display: inline-block;\">\n        üó∫Ô∏è Abrir Mapa Interativo em Tela Cheia\n    </a>\n</div>\n\n",
    "supporting": [
      "atividade2_files"
    ],
    "filters": [],
    "includes": {}
  }
}